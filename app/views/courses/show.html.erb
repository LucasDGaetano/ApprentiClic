<%# SHOW commune pour le cour de la capture d'écran et envoyer un email avec Gmail %>
<%# Section image du cour %>
<div>
  <%= cl_image_tag(@course.cover.key, class: "image-cour") if @course.cover.attached?%>
</div>
<div class="container">
  <%# Section titre et mini-descriptif du cour %>
  <div class="mb-5">
    <h1><strong><%= @course.title %></strong></h1>
    <p><%= @course.description %></p>
  </div>
  <%# Section chapitre du cour %>
  <% @chapters.each do |chapter| %>
    <% users_chapter = current_user.users_chapters.where(chapter_id: chapter).first %>
    <h4><%= chapter.title %></h4>
    <p><%= chapter.content.html_safe %></p>
    <%= cl_image_tag chapter.photo.key, height: 300, width: 400, crop: :fill if chapter.photo.attached?%>
    <%= cl_video_tag chapter.video.key, height: 300, width: 400, crop: :fill, controls: true if chapter.video.attached?%>
    <%# Section bouton j'ai compris pour faire évoluer la barre de progression %>
    <%= turbo_frame_tag "done_chapter_#{chapter.id}" do %>
      <%= link_to users_chapter_path(users_chapter), data: { turbo_method: :patch } do %>
          <button class="btn btn-success my-3" <%= 'disabled' if users_chapter.done %>><%= users_chapter.done? %></button>
        <% end %>
      <% end %>
      <hr>
    <% end %>
    <%# Section encart commentaire %>
    <div data-controller="toggle-comments">
        <button class="btn btn-info" data-action="click->toggle-comments#fire">Voir les commentaires</button>
        <div data-toggle-comments-target="toggable" class="d-none mt-3">
          <div class="my-3">
            <h5>Commentaires</h5>
            <% @course.comments.each do |comment| %>
              <div class="my-2">
                <p><strong><%= comment.user.username %></strong> - le <%= comment.created_at.strftime("%d/%m/%Y") %></p>
                <p><%= comment.content %></p>
                <div class= "container mx-5">
                  <% comment.answers.each do |answer| %>
                    <p><strong><%= answer.user.username %></strong> - le <%=answer.created_at.strftime("%d/%m/%Y")  %></p>
                  <p><%= answer.content %></p>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
    </div>

    <div>
      <%= simple_form_for [@course, @comment] do |f|%>
        <h6 class="mt-5">Laisser un commentaire</h6>
        <%= f.input :content, label: false%>
        <%= f.submit "Commenter", class: "btn btn-success mb-5" %>
      <% end %>
    </div>
  </div>
